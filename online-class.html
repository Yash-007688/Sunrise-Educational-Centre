<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Live Class - Sunrise Education Centre</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap">
    <style>
      /* Apple-Inspired Design System */
      :root {
        --apple-bg: #000000;
        --apple-text: #ffffff;
        --apple-text-secondary: #86868b;
        --apple-accent: #000000;
        --apple-accent-hover: #333333;
        --apple-gray: #1d1d1f;
        --apple-gray-light: #2d2d2f;
        --apple-border: #424245;
        --apple-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        --apple-radius: 12px;
        --apple-transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        --apple-card-bg: rgba(255, 255, 255, 0.03);
        --apple-card-hover: rgba(255, 255, 255, 0.08);
        --apple-input-bg: rgba(255, 255, 255, 0.05);
        --apple-input-border: rgba(255, 255, 255, 0.1);
        --apple-input-focus: rgba(255, 255, 255, 0.15);
        --apple-success: #34c759;
        --apple-warning: #ff9f0a;
        --apple-error: #ff3b30;
        --apple-live: #ff3b30;
        --apple-upcoming: #ff9f0a;
        --apple-completed: #86868b;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--apple-bg);
        color: var(--apple-text);
        line-height: 1.47059;
        font-weight: 400;
        letter-spacing: -0.022em;
        overflow-x: hidden;
      }

      /* Apple-Style Navigation */
      .navbar {
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--apple-border);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        transition: var(--apple-transition);
      }

      .nav-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 22px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 44px;
        position: relative;
      }

      /* Left: Coaching Logo */
      .nav-logo {
        flex-shrink: 0;
      }

      .nav-logo img {
        height: 32px;
        filter: brightness(0) invert(1);
        transition: var(--apple-transition);
      }

      .nav-logo img:hover {
        opacity: 0.8;
      }

      /* Center: Navigation Links */
      .nav-links {
        display: flex;
        list-style: none;
        gap: 32px;
        align-items: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      .nav-links a {
        color: var(--apple-text);
        text-decoration: none;
        font-size: 12px;
        font-weight: 400;
        transition: var(--apple-transition);
        opacity: 0.8;
        padding: 8px 16px;
        border-radius: 980px;
        position: relative;
      }

      .nav-links a:hover {
        opacity: 1;
        color: var(--apple-accent);
      }

      .nav-links a.active {
        background: var(--apple-text);
        color: var(--apple-bg);
        opacity: 1;
      }

      /* Right: Login/Logout Button */
      .nav-auth {
        flex-shrink: 0;
      }

      .nav-auth .btn-primary {
        background: var(--apple-accent);
        color: var(--apple-text);
        padding: 8px 16px;
        border-radius: 980px;
        font-size: 12px;
        font-weight: 500;
        transition: var(--apple-transition);
        border: 1px solid var(--apple-text);
        text-decoration: none;
        display: inline-block;
      }

      .nav-auth .btn-primary:hover {
        background: var(--apple-accent-hover);
        transform: scale(1.02);
      }

      /* Apple-Style Mobile Navigation */
      .hamburger {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        transition: var(--apple-transition);
      }

      .hamburger .bar {
        width: 20px;
        height: 2px;
        background: var(--apple-text);
        margin: 4px 0;
        transition: var(--apple-transition);
      }

      .hamburger.active .bar:nth-child(1) {
        transform: rotate(-45deg) translate(-5px, 6px);
      }

      .hamburger.active .bar:nth-child(2) {
        opacity: 0;
      }

      .hamburger.active .bar:nth-child(3) {
        transform: rotate(45deg) translate(-5px, -6px);
      }

      .nav-links.active {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid var(--apple-border);
        border-top: 1px solid var(--apple-border);
        padding: 20px;
        gap: 20px;
      }

      /* Apple-Style Hero Section */
      .hero-section {
        background: var(--apple-bg);
        min-height: 50vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 120px 22px 80px;
        position: relative;
      }

      .hero-content {
        max-width: 800px;
      }

      .hero-content h1 {
        font-size: 56px;
        font-weight: 600;
        line-height: 1.07143;
        letter-spacing: -0.005em;
        margin-bottom: 16px;
        background: linear-gradient(135deg, #ffffff 0%, #86868b 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-content p {
        font-size: 28px;
        font-weight: 400;
        line-height: 1.10722;
        letter-spacing: .004em;
        margin-bottom: 48px;
        color: var(--apple-text-secondary);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Apple-Style Main Content */
      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 22px 80px;
      }

      /* Apple-Style Test Button */
      .test-av-section {
        text-align: center;
        margin: 40px 0;
      }

      .btn-test-av {
        background: var(--apple-accent);
        color: var(--apple-text);
        border: 2px solid var(--apple-text);
        border-radius: 980px;
        padding: 18px 31px;
        font-size: 17px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--apple-transition);
        font-family: inherit;
        min-width: 180px;
      }

      .btn-test-av:hover {
        background: var(--apple-accent-hover);
        transform: scale(1.02);
      }

      /* Apple-Style Forum Section */
      .forum-section {
        background: var(--apple-card-bg);
        border: 1px solid var(--apple-border);
        border-radius: var(--apple-radius);
        padding: 48px;
        margin: 40px auto;
        max-width: 900px;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        box-shadow: var(--apple-shadow);
      }

      .forum-section h2 {
        font-size: 32px;
        font-weight: 600;
        line-height: 1.08349;
        letter-spacing: -.003em;
        margin-bottom: 16px;
        text-align: center;
        color: var(--apple-text);
      }

      .forum-section p {
        font-size: 18px;
        color: var(--apple-text-secondary);
        text-align: center;
        margin-bottom: 32px;
      }

      /* Apple-Style Tab Buttons */
      .tab-buttons {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin-bottom: 48px;
        flex-wrap: wrap;
      }

      .tab-btn {
        background: var(--apple-card-bg);
        border: 1px solid var(--apple-border);
        border-radius: var(--apple-radius);
        padding: 16px 32px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        color: var(--apple-text);
        transition: var(--apple-transition);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        min-width: 120px;
        text-align: center;
      }

      .tab-btn:hover {
        background: var(--apple-card-hover);
        border-color: var(--apple-text);
        transform: translateY(-2px);
      }

      .tab-btn.active {
        background: var(--apple-accent);
        border-color: var(--apple-accent);
        color: var(--apple-text);
        box-shadow: var(--apple-shadow);
      }

      .live-tab-btn.active {
        background: var(--apple-live);
        border-color: var(--apple-live);
      }

      .upcoming-tab-btn.active {
        background: var(--apple-warning);
        border-color: var(--apple-warning);
        color: var(--apple-bg);
      }

      .schedule-tab-btn.active {
        background: var(--apple-completed);
        border-color: var(--apple-completed);
      }

      /* Apple-Style Tab Content */
      .tab-content {
        display: none;
        animation: fadeIn 0.5s ease-out;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Apple-Style Class Cards */
      .live-class-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-top: 32px;
      }

      .class-card {
        background: var(--apple-card-bg);
        border: 1px solid var(--apple-border);
        border-radius: var(--apple-radius);
        padding: 32px;
        transition: var(--apple-transition);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        cursor: pointer;
      }

      .class-card:hover {
        background: var(--apple-card-hover);
        border-color: var(--apple-text);
        transform: translateY(-8px);
        box-shadow: var(--apple-shadow);
      }

      .class-card h3 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--apple-text);
        line-height: 1.3;
      }

      .class-card .class-info {
        color: var(--apple-text-secondary);
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 16px;
      }

      .class-card .class-code {
        font-size: 18px;
        color: var(--apple-text);
        margin-bottom: 12px;
        font-weight: 500;
      }

      .class-card .class-description {
        color: var(--apple-text-secondary);
        font-size: 16px;
        margin-bottom: 20px;
        line-height: 1.4;
      }

      .class-card .class-schedule {
        color: var(--apple-text-secondary);
        font-size: 14px;
        margin-bottom: 20px;
      }

      /* Apple-Style Buttons */
      .btn {
        transition: var(--apple-transition);
        cursor: pointer;
        border: none;
        font-family: inherit;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        border-radius: 980px;
        font-weight: 500;
        transition: var(--apple-transition);
      }

      .btn-primary {
        background: var(--apple-accent);
        color: var(--apple-text);
        border: 2px solid var(--apple-text);
        padding: 12px 24px;
        font-size: 16px;
        min-width: 90px;
      }

      .btn-primary:hover {
        background: var(--apple-accent-hover);
        transform: scale(1.02);
      }

      .btn-secondary {
        background: var(--apple-card-bg);
        color: var(--apple-text-secondary);
        border: 1px solid var(--apple-border);
        padding: 12px 24px;
        font-size: 16px;
        min-width: 90px;
        cursor: not-allowed;
      }

      .btn-secondary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Apple-Style Audio/Video Preview Dialog */
      .av-preview-dialog {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      .av-preview-content {
        background: var(--apple-gray);
        border: 1px solid var(--apple-border);
        border-radius: var(--apple-radius);
        padding: 48px;
        max-width: 500px;
        margin: auto;
        box-shadow: var(--apple-shadow);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      .av-preview-content h3 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 24px;
        color: var(--apple-text);
        text-align: center;
      }

      .av-preview-content label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--apple-text);
        font-size: 14px;
      }

      .av-preview-content select {
        width: 100%;
        background: var(--apple-input-bg);
        border: 1px solid var(--apple-input-border);
        border-radius: 8px;
        padding: 12px;
        font-size: 16px;
        color: var(--apple-text);
        transition: var(--apple-transition);
        font-family: inherit;
        margin-bottom: 16px;
      }

      .av-preview-content select:focus {
        outline: none;
        border-color: var(--apple-input-focus);
        background: var(--apple-input-focus);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
      }

      .av-preview-content select option {
        background: var(--apple-gray);
        color: var(--apple-text);
        padding: 8px;
      }

      .av-preview-content video {
        width: 100%;
        max-width: 320px;
        height: auto;
        background: var(--apple-bg);
        border-radius: var(--apple-radius);
        margin: 16px auto;
        display: block;
        box-shadow: var(--apple-shadow);
      }

      .av-preview-content .test-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin: 24px 0;
        flex-wrap: wrap;
      }

      .av-preview-content .test-status {
        margin: 16px 0;
        font-weight: 500;
        color: var(--apple-text-secondary);
        text-align: center;
        min-height: 24px;
      }

      .av-preview-content .mic-test {
        margin: 16px 0;
        text-align: center;
      }

      .av-preview-content .mic-level {
        display: inline-block;
        width: 80px;
        height: 10px;
        background: var(--apple-input-bg);
        border-radius: 5px;
        vertical-align: middle;
        margin-left: 12px;
        transition: var(--apple-transition);
      }

      /* Apple-Style Mobile Navigation */
      .hamburger {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        transition: var(--apple-transition);
      }

      .hamburger .bar {
        width: 20px;
        height: 2px;
        background: var(--apple-text);
        margin: 4px 0;
        transition: var(--apple-transition);
      }

      .hamburger.active .bar:nth-child(1) {
        transform: rotate(-45deg) translate(-5px, 6px);
      }

      .hamburger.active .bar:nth-child(2) {
        opacity: 0;
      }

      .hamburger.active .bar:nth-child(3) {
        transform: rotate(45deg) translate(-5px, -6px);
      }

      .nav-links.active {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid var(--apple-border);
        padding: 20px;
        gap: 20px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .nav-links {
          display: none;
        }

        .hamburger {
          display: block;
        }

        .hero-content h1 {
          font-size: 40px;
        }

        .hero-content p {
          font-size: 21px;
        }

        .forum-section {
          padding: 32px 24px;
          margin: 20px;
        }

        .tab-buttons {
          flex-direction: column;
          align-items: center;
        }

        .tab-btn {
          width: 100%;
          max-width: 300px;
          text-align: center;
        }

        .live-class-cards {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .class-card {
          padding: 24px;
        }

        .av-preview-content {
          padding: 32px 24px;
          margin: 20px;
        }
      }

      @media (max-width: 480px) {
        .hero-content h1 {
          font-size: 32px;
        }

        .hero-content p {
          font-size: 18px;
        }

        .forum-section {
          padding: 24px 20px;
        }

        .tab-btn {
          padding: 14px 20px;
          font-size: 14px;
        }

        .class-card {
          padding: 20px;
        }

        .av-preview-content {
          padding: 24px 20px;
        }
      }

      /* Apple-Style Animations */
      .fade-in-up {
        animation: fadeInUp 0.8s ease-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Apple-Style Focus States */
      .btn:focus,
      .tab-btn:focus,
      .av-preview-content select:focus {
        outline: 2px solid var(--apple-accent);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <!-- Apple-Style Navigation -->
    <nav class="navbar">
      <div class="nav-content">
        <div class="nav-logo">
          <img src="attached_assets/image_1750584670920.png" alt="Sunrise Education Centre">
        </div>
        <!-- Center: Navigation Links -->
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/online-class">Live Class</a></li>
          <li><a href="/study-resources">Study Resources</a></li>
          <li><a href="/forum">Forum</a></li>
          <li><a href="/profile">Profile</a></li>
        </ul>
        
        <!-- Right: Login/Logout Button -->
        <div class="nav-auth">
          {% if username %}
            <a href="/logout" class="btn-primary">Logout</a>
          {% else %}
            <a href="/auth" class="btn-primary">Login</a>
          {% endif %}
        </div>
        <button class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </nav>
    <!-- Apple-Style Hero Section -->
    <header class="hero-section">
      <div class="hero-content fade-in-up">
        <h1>Join a Live Class</h1>
        <p>Experience interactive, real-time mathematics coaching from anywhere!</p>
      </div>
    </header>

    <!-- Apple-Style Main Content -->
    <main class="main-content">
      <!-- Apple-Style Test Audio/Video Section -->
      <div class="test-av-section">
        <button id="previewAVBtn" class="btn-test-av">Test Audio/Video</button>
      </div>
      <!-- Apple-Style Audio/Video Preview Dialog -->
      <div id="avPreviewDialog" class="av-preview-dialog">
        <div class="av-preview-content">
          <h3>Audio/Video Preview</h3>
          <div>
            <label for="videoSelect">Camera:</label>
            <select id="videoSelect"></select>
            <label for="audioSelect">Microphone:</label>
            <select id="audioSelect"></select>
            <label for="speakerSelect">Speaker:</label>
            <select id="speakerSelect"></select>
          </div>
          <video id="previewVideo" autoplay muted playsinline></video>
          <div class="test-buttons">
            <button id="testCameraBtn" class="btn btn-primary" onclick="testCameraAndMic()">Test Camera & Mic</button>
            <button id="stopTestBtn" class="btn btn-secondary" onclick="stopTest()">Stop Test</button>
          </div>
          <div id="testStatus" class="test-status"></div>
          <div class="mic-test">
            <button id="testMicBtn" class="btn btn-secondary">Test Microphone</button>
            <span id="micLevel" class="mic-level"></span>
          </div>
          <div class="mic-test">
            <button id="testSpeakerBtn" class="btn btn-secondary">Test Speaker</button>
            <audio id="testAudio" style="display:none;">
              <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
            </audio>
          </div>
          <button id="closeAVDialog" class="btn btn-primary">Close</button>
        </div>
      </div>
      <!-- Apple-Style Forum Section -->
      <section class="forum-section fade-in-up">
        <h2>Live Class Management</h2>
        <p>Join ongoing classes, view upcoming schedules, and access completed recordings</p>
        
        <!-- Apple-Style Tab Buttons -->
        <div class="tab-buttons">
          <button class="live-tab-btn tab-btn active" onclick="showLiveTab('live')">Live</button>
          <button class="upcoming-tab-btn tab-btn" onclick="showLiveTab('upcoming')">Upcoming</button>
          <button class="schedule-tab-btn tab-btn" onclick="showLiveTab('schedule')">Completed</button>
        </div>
        <!-- Live Tab Content -->
        <div id="live-tab-content" class="tab-content active">
          <h2>Live Classes</h2>
          <p>Join ongoing live classes here.</p>
          {% if active_classes and active_classes|length > 0 %}
            <div class="live-class-cards">
              {% for c in active_classes %}
                <div class="class-card">
                  <h3>{{ c[4] or 'Live Class' }}</h3>
                  {% if c|length > 12 %}
                  <div class="class-info">
                    {% set subj = c[13] %}{% if subj %}<strong>Subject:</strong> {{ subj|capitalize }}{% endif %}
                    {% if c[14] %}{% if subj %} • {% endif %}<strong>Teacher:</strong> {{ c[14] }}{% endif %}
                    {% if c[9] %}
                      <br><strong>Target:</strong> Class {{ c[9] }}{% if c[9] in ['11','12'] and c[10] %} ({{ c[10]|capitalize }}){% endif %}
                    {% endif %}
                  </div>
                  {% endif %}
                  <div class="class-code"><strong>Class Code:</strong> {{ c[1] }}</div>
                  <div class="class-description">{{ c[5] or '' }}</div>
                  <a href="/join-class/{{ c[0] }}" class="btn btn-primary">Join</a>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p style="text-align:center; color:var(--apple-text-secondary);">No live classes are currently active.</p>
          {% endif %}
        </div>
        <div id="upcoming-tab-content" class="tab-content" style="display:none;">
          <h2 style="text-align:center;">Upcoming Classes</h2>
          <p style="text-align:center;">See which classes are scheduled to go live soon.</p>
          {% if upcoming_classes and upcoming_classes|length > 0 %}
            <div class="live-class-cards" style="display:flex; flex-wrap:wrap; gap:2rem; justify-content:center;">
              {% for c in upcoming_classes %}
                <div class="card-section" style="min-width:260px; max-width:340px; background:#f4f4f4; border-radius:14px; box-shadow:0 2px 8px rgba(100,100,255,0.07); padding:1.5rem;">
                  <h3 style="color:#ffa726;">{{ c[4] or 'Upcoming Class' }}</h3>
                  {% if c|length > 12 %}
                  <div style="font-size:0.96rem; color:#555; margin:0.2rem 0 0.6rem 0;">
                    {% set subj = c[13] %}{% if subj %}<strong>Subject:</strong> {{ subj|capitalize }}{% endif %}
                    {% if c[14] %}{% if subj %} • {% endif %}<strong>Teacher:</strong> {{ c[14] }}{% endif %}
                    {% if c[9] %}
                      <br><strong>Target:</strong> Class {{ c[9] }}{% if c[9] in ['11','12'] and c[10] %} ({{ c[10]|capitalize }}){% endif %}
                    {% endif %}
                  </div>
                  {% endif %}
                  <div style="font-size:1.1rem; color:#232946; margin-bottom:0.7rem;"><strong>Class Code:</strong> {{ c[1] }}</div>
                  <div style="font-size:0.98rem; color:#888; margin-bottom:1.2rem;">{{ c[5] or '' }}</div>
                  {% if c[8] %}<div style="font-size:0.95rem; color:#888;">Scheduled: {{ c[8] }}</div>{% endif %}
                  <button class="btn btn-secondary" style="width:auto; min-width:90px; margin-top:0.7rem; background:#ccc; color:#888; cursor:not-allowed;" disabled>Pending</button>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p style="text-align:center;">No upcoming classes scheduled.</p>
          {% endif %}
        </div>
        <!-- Completed Tab Content -->
        <div id="schedule-tab-content" class="tab-content">
          <h2>Completed Classes</h2>
          <p>View the full schedule of all completed classes.</p>
          {% if completed_classes and completed_classes|length > 0 %}
            <div class="live-class-cards">
              {% for c in completed_classes %}
                <div class="class-card">
                  <h3>{{ c[4] or 'Completed Class' }}</h3>
                  {% if c|length > 12 %}
                  <div class="class-info">
                    {% set subj = c[13] %}{% if subj %}<strong>Subject:</strong> {{ subj|capitalize }}{% endif %}
                    {% if c[14] %}{% if subj %} • {% endif %}<strong>Teacher:</strong> {{ c[14] }}{% endif %}
                    {% if c[9] %}
                      <br><strong>Target:</strong> Class {{ c[9] }}{% if c[9] in ['11','12'] and c[10] %} ({{ c[10]|capitalize }}){% endif %}
                    {% endif %}
                  </div>
                  {% endif %}
                  <div class="class-code"><strong>Class Code:</strong> {{ c[1] }}</div>
                  <div class="class-description">{{ c[5] or '' }}</div>
                  {% if c[8] %}<div class="class-schedule">Scheduled: {{ c[8] }}</div>{% endif %}
                  {% if c[3] %}
                    <a href="{{ c[3] }}" class="btn btn-primary" target="_blank">View Recording</a>
                  {% else %}
                    <button class="btn btn-secondary" disabled>No Recording</button>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p style="text-align:center; color:var(--apple-text-secondary);">No completed classes yet.</p>
          {% endif %}
        </div>
      </section>

    </main>
    <footer class="footer" style="background:#181c2a; color:#fff;">
      <div class="container footer-content">
        <div class="footer-social" style="display:flex; gap:1.2rem;">
          <a href="https://www.instagram.com/sunrise_education_centre?igsh=OGc5enlsanE0eWJ2" target="_blank">Instagram</a>
          <a href="https://youtube.com/@sunriseeducationcentre" target="_blank">YouTube</a>
        </div>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Contact Us</a>
        </div>
        <div class="footer-copy">&copy; 2024 Sunrise Education Centre</div>
      </div>
    </footer>
    <script>
      function showLiveTab(tab) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Show selected tab content
        document.getElementById(tab + '-tab-content').classList.add('active');
        
        // Add active class to selected tab button
        if (tab === 'live') {
          document.querySelector('.live-tab-btn').classList.add('active');
        } else if (tab === 'upcoming') {
          document.querySelector('.upcoming-tab-btn').classList.add('active');
        } else if (tab === 'schedule') {
          document.querySelector('.schedule-tab-btn').classList.add('active');
        }
        
        // Refresh class status when tab is changed
        refreshClassStatus();
      }

      // Auto-refresh class status every 30 seconds
      function refreshClassStatus() {
        fetch('/api/live-classes/status')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Check if page needs to be refreshed due to status changes
              const hasActiveClasses = data.active && data.active.length > 0;
              const hasUpcomingClasses = data.upcoming && data.upcoming.length > 0;
              const hasCompletedClasses = data.completed && data.completed.length > 0;
              
              // If significant changes detected, refresh the page
              if (shouldRefreshPage(hasActiveClasses, hasUpcomingClasses, hasCompletedClasses)) {
                console.log('Class status changed, refreshing page...');
                window.location.reload();
              }
            }
          })
          .catch(error => {
            console.log('Status check failed:', error);
          });
      }

      // Check if page should be refreshed based on status changes
      function shouldRefreshPage(hasActive, hasUpcoming, hasCompleted) {
        const currentActiveClasses = document.querySelectorAll('#live-tab-content .class-card').length;
        const currentUpcomingClasses = document.querySelectorAll('#upcoming-tab-content .class-card').length;
        const currentCompletedClasses = document.querySelectorAll('#schedule-tab-content .class-card').length;
        
        // Refresh if active classes count changed significantly
        return (hasActive && currentActiveClasses === 0) || (!hasActive && currentActiveClasses > 0);
      }

      // Start auto-refresh when page loads
      setInterval(refreshClassStatus, 30000); // 30 seconds

      const notifBell = document.getElementById('notifBell');
      const notifDropdown = document.getElementById('notifDropdown');
      if (notifBell && notifDropdown) {
        // Handled globally in script.js. Keep only page-specific logic below.
      }

      // Audio/Video Preview Dialog
      const previewBtn = document.getElementById('previewAVBtn');
      const avDialog = document.getElementById('avPreviewDialog');
      const closeAVDialog = document.getElementById('closeAVDialog');
      const previewVideo = document.getElementById('previewVideo');
      const testMicBtn = document.getElementById('testMicBtn');
      const micLevel = document.getElementById('micLevel');
      const testSpeakerBtn = document.getElementById('testSpeakerBtn');
      const testAudio = document.getElementById('testAudio');
      const videoSelect = document.getElementById('videoSelect');
      const audioSelect = document.getElementById('audioSelect');
      const speakerSelect = document.getElementById('speakerSelect');
      let avStream = null;
      let audioContext = null;
      let analyser = null;
      let micSource = null;
      let animationId = null;

      // Load available devices
      async function loadDevices() {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          videoSelect.innerHTML = '';
          audioSelect.innerHTML = '';
          speakerSelect.innerHTML = '';
          
          devices.forEach(device => {
            const option = document.createElement('option');
            option.value = device.deviceId;
            option.text = device.label || `${device.kind} ${device.deviceId.slice(0, 8)}`;
            
            if (device.kind === 'videoinput') {
              videoSelect.appendChild(option);
            } else if (device.kind === 'audioinput') {
              audioSelect.appendChild(option);
            }
          });
          
          // For speakers, we'll use a simple test
          const speakerOption = document.createElement('option');
          speakerOption.value = 'default';
          speakerOption.text = 'Default Speaker';
          speakerSelect.appendChild(speakerOption);
        } catch (err) {
          console.error('Error loading devices:', err);
        }
      }

      previewBtn.onclick = async function() {
        avDialog.style.display = 'flex';
        await loadDevices();
        
        try {
          const constraints = {
            video: { deviceId: videoSelect.value ? { exact: videoSelect.value } : undefined },
            audio: { deviceId: audioSelect.value ? { exact: audioSelect.value } : undefined }
          };
          
          avStream = await navigator.mediaDevices.getUserMedia(constraints);
          previewVideo.srcObject = avStream;
        } catch (err) {
          console.error('Error accessing media devices:', err);
          alert('Could not access camera/microphone. Please check permissions and try again.');
        }
      };

      closeAVDialog.onclick = function() {
        avDialog.style.display = 'none';
        if (avStream) {
          avStream.getTracks().forEach(track => track.stop());
          avStream = null;
        }
        if (audioContext) {
          audioContext.close();
          audioContext = null;
        }
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
        micLevel.style.background = '#eee';
      };

      testMicBtn.onclick = function() {
        if (!avStream) return;
        if (audioContext) {
          audioContext.close();
          audioContext = null;
          micLevel.style.background = '#eee';
          return;
        }
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        micSource = audioContext.createMediaStreamSource(avStream);
        analyser = audioContext.createAnalyser();
        micSource.connect(analyser);
        analyser.fftSize = 256;
        const dataArray = new Uint8Array(analyser.frequencyBinCount);
        function draw() {
          analyser.getByteTimeDomainData(dataArray);
          let sum = 0;
          for (let i = 0; i < dataArray.length; i++) {
            sum += Math.abs(dataArray[i] - 128);
          }
          let avg = sum / dataArray.length;
          let percent = Math.min(1, avg / 30);
          micLevel.style.background = `linear-gradient(90deg, #6a82fb ${percent*100}%, #eee ${percent*100}%)`;
          animationId = requestAnimationFrame(draw);
        }
        draw();
      };

      testSpeakerBtn.onclick = function() {
        testAudio.currentTime = 0;
        testAudio.play().catch(err => {
          console.error('Error playing test audio:', err);
          alert('Could not play test audio. Please check your speaker settings.');
        });
      };

      // Handle device changes
      videoSelect.onchange = audioSelect.onchange = async function() {
        if (avStream) {
          avStream.getTracks().forEach(track => track.stop());
        }
        
        try {
          const constraints = {
            video: { deviceId: videoSelect.value ? { exact: videoSelect.value } : undefined },
            audio: { deviceId: audioSelect.value ? { exact: audioSelect.value } : undefined }
          };
          
          avStream = await navigator.mediaDevices.getUserMedia(constraints);
          previewVideo.srcObject = avStream;
        } catch (err) {
          console.error('Error switching devices:', err);
          alert('Could not switch to selected device. Please try again.');
        }
      };

      // Test camera and microphone
      async function testCameraAndMic() {
        const testVideo = document.getElementById('testVideo');
        const micLevel = document.getElementById('micLevel');
        const testStatus = document.getElementById('testStatus');
        
        testStatus.textContent = 'Testing camera and microphone...';
        
        try {
          // Check browser support
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            testStatus.textContent = '❌ Camera/microphone not supported in this browser';
            return;
          }
          
          // Get user media
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: true, 
            audio: true 
          });
          
          // Show video preview
          testVideo.srcObject = stream;
          testVideo.style.display = 'block';
          
          // Test microphone level
          const audioContext = new AudioContext();
          const source = audioContext.createMediaStreamSource(stream);
          const analyser = audioContext.createAnalyser();
          source.connect(analyser);
          
          const dataArray = new Uint8Array(analyser.frequencyBinCount);
          
          function updateMicLevel() {
            analyser.getByteFrequencyData(dataArray);
            const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
            const level = Math.min(100, (average / 128) * 100);
            
            micLevel.style.width = level + '%';
            micLevel.style.backgroundColor = level > 50 ? '#10b981' : level > 20 ? '#f59e0b' : '#ef4444';
            
            if (stream.active) {
              requestAnimationFrame(updateMicLevel);
            }
          }
          
          updateMicLevel();
          
          testStatus.textContent = '✅ Camera and microphone working!';
          testStatus.style.color = '#059669';
          
          // Store stream for cleanup
          window.testStream = stream;
          
        } catch (err) {
          console.error('Test error:', err);
          let errorMsg = 'Failed to access camera/microphone';
          
          if (err.name === 'NotAllowedError') {
            errorMsg = '❌ Permission denied. Please allow camera and microphone access.';
          } else if (err.name === 'NotFoundError') {
            errorMsg = '❌ No camera or microphone found.';
          } else if (err.name === 'NotReadableError') {
            errorMsg = '❌ Camera/microphone is already in use by another app.';
          } else {
            errorMsg = `❌ Error: ${err.message}`;
          }
          
          testStatus.textContent = errorMsg;
          testStatus.style.color = '#dc2626';
        }
      }
      
      // Stop test stream
      function stopTest() {
        if (window.testStream) {
          window.testStream.getTracks().forEach(track => track.stop());
          window.testStream = null;
        }
        const testVideo = document.getElementById('testVideo');
        testVideo.style.display = 'none';
        testVideo.srcObject = null;
      }
    </script>
    <style>
      body.dark-mode, .dark-mode body {
        background: #181c2a !important;
        color: #f4f4f4 !important;
      }
      body.dark-mode .card-section, .dark-mode .card-section {
        background: #232946 !important;
        color: #f4f4f4 !important;
        box-shadow: 0 4px 32px rgba(35,41,70,0.25) !important;
      }
      body.dark-mode .navbar, .dark-mode .navbar {
        background: #232946 !important;
        color: #f4f4f4 !important;
      }
      body.dark-mode .btn, .dark-mode .btn {
        background: #232946 !important;
        color: #fff !important;
        border-color: #6a82fb !important;
      }
      body.dark-mode input, body.dark-mode select, body.dark-mode textarea,
      .dark-mode input, .dark-mode select, .dark-mode textarea {
        background: #181c2a !important;
        color: #f4f4f4 !important;
        border: 1.5px solid #444a6d !important;
      }
      body.dark-mode input:focus, body.dark-mode select:focus, body.dark-mode textarea:focus,
      .dark-mode input:focus, .dark-mode select:focus, .dark-mode textarea:focus {
        border-color: #6a82fb !important;
        background: #232946 !important;
      }
      body.dark-mode .footer, .dark-mode .footer {
        background: #181c2a !important;
        color: #fff !important;
      }
      body.dark-mode .btn-primary, .dark-mode .btn-primary {
        background: linear-gradient(90deg, #232946 0%, #6a82fb 100%) !important;
        color: #fff !important;
      }
      body.dark-mode .btn-primary:hover, .dark-mode .btn-primary:hover {
        background: linear-gradient(90deg, #6a82fb 0%, #232946 100%) !important;
      }
      .live-class-cards .card-section {
        min-width:260px;
        max-width:340px;
        background:#f4f4f4;
        border-radius:14px;
        box-shadow:0 2px 8px rgba(100,100,255,0.07);
        padding:1.5rem;
        margin-bottom: 1rem;
        color: #232946;
        border: 1px solid #e0e7ff;
        transition: background 0.2s, color 0.2s;
      }
      body.dark-mode .live-class-cards .card-section {
        background: #232946;
        color: #fff;
        border: 1px solid #44476a;
        box-shadow: 0 2px 12px rgba(40,40,80,0.18);
      }
      body.dark-mode .live-class-cards .card-section h3 {
        color: #6a82fb;
      }
      body.dark-mode .live-class-cards .card-section a.btn-primary {
        background: linear-gradient(135deg, #6a82fb 0%, #5a6fd8 100%);
        color: #fff;
      }
      body.dark-mode .live-class-cards .card-section a.btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a82fb 100%);
      }
      body.dark-mode .live-class-cards .card-section strong,
      body.dark-mode .live-class-cards .card-section .class-code,
      body.dark-mode .live-class-cards .card-section .class-description {
        color: #e0e7ff;
      }
      
      /* Mobile Responsive Styles */
      @media (max-width: 768px) {
        .card-section {
          padding: 1rem;
          margin: 1rem 0;
        }
        
        .live-class-cards {
          flex-direction: column;
          align-items: center;
        }
        
        .live-class-cards .card-section {
          min-width: auto;
          max-width: 100%;
          width: 100%;
          margin: 0.5rem 0;
        }
        
        .tab-btn {
          padding: 0.6rem 1.2rem !important;
          font-size: 0.9rem !important;
          margin: 0 0.3rem;
        }
        
        .container {
          padding: 0 1rem;
        }
      }
      
      @media (max-width: 480px) {
        .card-section {
          padding: 0.8rem;
        }
        
        .live-class-cards .card-section {
          padding: 1rem;
        }
        
        .tab-btn {
          padding: 0.5rem 1rem !important;
          font-size: 0.8rem !important;
          margin: 0 0.2rem;
        }
        
        .container {
          padding: 0 0.5rem;
        }
        
        h2 {
          font-size: 1.5rem;
        }
        
        h3 {
          font-size: 1.2rem;
        }
      }
      
      @media (max-width: 320px) {
        .card-section {
          padding: 0.5rem;
        }
        
        .live-class-cards .card-section {
          padding: 0.8rem;
        }
        
        .tab-btn {
          padding: 0.4rem 0.8rem !important;
          font-size: 0.75rem !important;
          margin: 0 0.1rem;
        }
        
        .container {
          padding: 0 0.3rem;
        }
        
        h2 {
          font-size: 1.3rem;
        }
        
        h3 {
          font-size: 1.1rem;
        }
      }
    </style>
    <script>
      // Apple-Style Enhancements
      document.addEventListener('DOMContentLoaded', function() {
        // Add smooth animations to class cards
        const classCards = document.querySelectorAll('.class-card');
        classCards.forEach((card, index) => {
          card.style.animationDelay = `${index * 0.1}s`;
          card.classList.add('fade-in-up');
        });

        // Add hover effects to tab buttons
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(btn => {
          btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
          });
          btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
          });
        });

        // Add smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });

        // Mobile navigation toggle
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        if (hamburger && navLinks) {
          hamburger.addEventListener('click', function() {
            navLinks.classList.toggle('active');
            this.classList.toggle('active');
          });
        }
      });
    </script>
  </body>
</html>
