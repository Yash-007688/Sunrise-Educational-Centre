<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Batch - Sunrise Education Centre</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="floating-navbar.css" />
    <style>
      .batch-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
      }
      .batch-card {
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        overflow: hidden;
        background: #fff;
        box-shadow: 0 4px 16px rgba(100,100,255,0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .batch-card:hover { 
        transform: translateY(-4px);
        box-shadow: 0 10px 28px rgba(100,100,255,0.15);
      }
      .batch-image { 
        width: 100%;
        height: 150px;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .batch-image img { 
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .batch-info {
        padding: 0.9rem 1rem 1rem 1rem;
      }
      .batch-info h3 {
        margin: 0 0 0.4rem 0;
        font-size: 1.05rem;
        color: #232946;
      }
      .batch-meta { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 0.35rem 0.6rem; 
        font-size: 0.92rem; 
        color: #6b7280;
        margin-bottom: 0.7rem;
      }
      .batch-actions { 
        display: flex; 
        gap: 0.5rem; 
        flex-wrap: wrap; 
      }
      body.dark-mode .batch-card { background:#232946; border-color:#3a3a4a; }
      body.dark-mode .batch-info h3 { color: #e2e8f0; }
      body.dark-mode .batch-meta { color: #b8c5d6; }
      /* Tabs styling */
      .tabs { display:flex; gap:0.5rem; flex-wrap:wrap; }
      .tab-btn {
        padding: 0.45rem 0.9rem;
        border: 1px solid #e5e7eb;
        border-radius: 9999px;
        background: #fff;
        color: #232946;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .tab-btn:hover { background:#f3f6ff; border-color:#dbeafe; }
      .tab-btn.active { background:#6a82fb; color:#fff; border-color:#6a82fb; }
      body.dark-mode .tab-btn { background:#1f2440; border-color:#3a3a4a; color:#e2e8f0; }
      body.dark-mode .tab-btn:hover { background:#252b4d; border-color:#4a4a5a; }
      body.dark-mode .tab-btn.active { background:#6a82fb; color:#fff; border-color:#6a82fb; }

      /* Card polish */
      .card.animated-card { border-radius:16px; box-shadow:0 4px 16px rgba(100,100,255,0.08); }
      .batch-info h3 { font-weight:600; }
    </style>
  </head>
  <body>
    <!-- Floating Navbar -->
    <nav class="floating-navbar">
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/online-class">Live Classes</a></li>
            <li><a href="/batch">Batches</a></li>
            <li><a href="/study-resources">Resources</a></li>
            <li><a href="/forum">Forum</a></li>
            <li><a href="/admission">Admission</a></li>
            <li><button class="search-btn" onclick="openSearch()">üîç Search</button></li>
            {% if username %}
            <li style="position:relative;">
                <button id="notifBell" class="notification-bell">
                    üîî
                    {% if user_notifications and user_notifications|length > 0 %}
                    <span class="notification-badge"></span>
                    {% endif %}
                </button>
            </li>
            <li><a href="/profile" class="btn-primary">Profile</a></li>
            <li><a href="/logout" class="btn-primary">Logout</a></li>
            {% else %}
            <li><a href="/auth" class="btn-primary">Login</a></li>
            {% endif %}
        </ul>
    </nav>

    <main class="container main-content">
      {% if is_logged_in %}
      <section class="card animated-card" style="padding: 1.2rem 1rem;">
        <div style="display:flex; gap:0.6rem; align-items:center; justify-content:space-between; flex-wrap:wrap;">
          <h2 style="margin:0;">My Batches</h2>
          <div style="display:flex; gap:0.4rem;">
            <button class="tab-btn active" data-filter="paid">Paid</button>
            <button class="tab-btn" data-filter="free">Free</button>
          </div>
        </div>
        <div id="paid-section" class="batch-grid" style="margin-top:0.8rem;">
          {% if paid_cards and paid_cards|length > 0 %}
            {% for card in paid_cards %}
            <div class="batch-card">
              <div class="batch-image">
                <img src="{{ card.image }}" alt="{{ card.batch_name }}" />
              </div>
              <div class="batch-info">
                <h3>{{ card.batch_name }}</h3>
                <div class="batch-meta">
                  <div><strong>Class</strong>: {{ card.class_name }}</div>
                  <div><strong>ID</strong>: {{ card.class_id }}</div>
                  <div><strong>Start</strong>: {{ card.start_date }}</div>
                  <div><strong>End</strong>: {{ card.end_date }}</div>
                </div>
                <div class="batch-actions">
                  {% if user_paid_status == 'paid' %}
                  <a class="btn btn-primary" href="/batch/{{ card.class_id }}">Explore</a>
                  {% else %}
                  <a class="btn btn-primary" href="/admission">Buy Now</a>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div style="color:#6b7280;">No paid batches available.</div>
          {% endif %}
        </div>
        <div id="free-section" class="batch-grid" style="display:none; margin-top:0.8rem;">
          {% if free_cards and free_cards|length > 0 %}
            {% for card in free_cards %}
            <div class="batch-card">
              <div class="batch-image">
                <img src="{{ card.image }}" alt="{{ card.batch_name }}" />
              </div>
              <div class="batch-info">
                <h3>{{ card.batch_name }}</h3>
                <div class="batch-meta">
                  <div><strong>Class</strong>: {{ card.class_name }}</div>
                  <div><strong>ID</strong>: {{ card.class_id }}</div>
                  <div><strong>Start</strong>: {{ card.start_date }}</div>
                  <div><strong>End</strong>: {{ card.end_date }}</div>
                </div>
                <div class="batch-actions">
                  <a class="btn btn-secondary" href="/batch/{{ card.class_id }}">Explore</a>
                </div>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div style="color:#6b7280;">No free batches available.</div>
          {% endif %}
        </div>
      </section>
      {% else %}
      <section class="card animated-card" style="padding: 1.2rem 1rem;">
        <h2 style="margin:0 0 0.8rem 0;">All Batches</h2>
        <div style="display:flex; flex-direction:column; gap:0.8rem;">
          {% for card in all_cards %}
          <div class="batch-card" style="display:flex; gap:0.8rem;">
            <div class="batch-image" style="flex:0 0 180px; height:120px;">
              <img src="{{ card.image }}" alt="{{ card.batch_name }}" />
            </div>
            <div class="batch-info" style="flex:1;">
              <h3 style="margin-top:0;">{{ card.batch_name }}</h3>
              <div class="batch-meta" style="grid-template-columns:repeat(4, auto); gap:0.8rem;">
                <div><strong>Class</strong>: {{ card.class_name }}</div>
                <div><strong>ID</strong>: {{ card.class_id }}</div>
                <div><strong>Start</strong>: {{ card.start_date }}</div>
                <div><strong>End</strong>: {{ card.end_date }}</div>
              </div>
              <div class="batch-actions">
                <a class="btn btn-primary" href="/admission">Buy Now</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endif %}
      {% if is_logged_in %}
      <section class="card animated-card" style="padding: 1.2rem 1rem;">
        <h1 style="margin: 0.2rem 0 0.8rem 0;">My Batch</h1>
        <p style="margin: 0; color: #6b7280;">Welcome{% if username %}, {{ username }}{% endif %}. Your class: <strong>{{ role }}</strong> (ID: {{ class_id }})</p>
      </section>
      {% endif %}

      <section class="card animated-card" style="padding: 1.2rem 1rem;">
        <h2 style="margin-top:0;">Batch Links</h2>
        <ul style="list-style:none; padding:0; margin:0; display:flex; gap:0.6rem; flex-wrap:wrap;">
          <li><a class="btn btn-primary" href="/online-class">Join Live Class</a></li>
          <li><a class="btn btn-secondary" href="/study-resources">Study Resources</a></li>
          <li><a class="btn btn-secondary" href="/forum">Forum</a></li>
          <li><a class="btn btn-secondary" href="/profile">Profile</a></li>
        </ul>
      </section>

      <section class="card animated-card" style="padding: 1.2rem 1rem;">
        <h2 style="margin-top:0;">Announcements</h2>
        <div id="batchAnnouncements" style="color:#6b7280;">No announcements yet.</div>
      </section>
    </main>

    <script>
      // Search functionality
      function openSearch() {
          const searchTerm = prompt("Enter your search term:");
          if (searchTerm) {
              // Search through batch cards
              const batchCards = document.querySelectorAll('.batch-card');
              let found = false;
              
              batchCards.forEach(card => {
                  const title = card.querySelector('h3').textContent.toLowerCase();
                  const searchLower = searchTerm.toLowerCase();
                  
                  if (title.includes(searchLower)) {
                      card.style.display = 'block';
                      card.style.border = '2px solid #0066cc';
                      found = true;
                  } else {
                      card.style.display = 'none';
                  }
              });
              
              if (!found) {
                  alert('No batches found matching your search term.');
              }
          }
      }

      // Toggle between paid and free sections for logged-in users
      document.addEventListener('DOMContentLoaded', function() {
        const filterButtons = document.querySelectorAll('.tab-btn[data-filter]');
        const paidSection = document.getElementById('paid-section');
        const freeSection = document.getElementById('free-section');
        if (filterButtons.length && paidSection && freeSection) {
          filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
              filterButtons.forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              const filter = btn.getAttribute('data-filter');
              if (filter === 'paid') {
                paidSection.style.display = '';
                freeSection.style.display = 'none';
              } else {
                paidSection.style.display = 'none';
                freeSection.style.display = '';
              }
            });
          });
        }
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>

